import random
import re
from datetime import datetime
import json
import os

# PDFã‹ã‚‰æŠ½å‡ºã—ãŸæ³¢å‹•ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿
hadou_data = {
    "æ„Ÿæƒ…æ³¢å‹•": {
        "45-672": "æ€’ã‚Š",
        "135-489": "ç„¡é–¢å¿ƒãƒ»æ„Ÿæƒ…éº»ç—º",
        "235-493": "å¹¸ç¦æ„Ÿã®æ¬ å¦‚",
        "335-883": "ç„¡è¡¨æƒ…ãª",
        "435-891": "ç™Œã«å¯¾ã™ã‚‹ææ€–",
        "535-896": "è™šå½ãƒ»æ¬ºã",
        "645-055": "ã‚„ãã‚‚ã¡",
        "745-056": "æ¶ˆæ¥µæ€§ãƒ»å¦å®šçš„",
        "845-072": "åè¦‹ãƒ»ã²ãŒã¿",
        "955-160": "å¿ƒé…ãƒ»ä¸å®‰",
        "1055-168": "æ„šå›³",
        "1145-236": "å€¦æ€ ãƒ»é£½ãã£ã½ã„",
        "1245-266": "è‹›ç«‹ã¡ãƒ»ã„ã‚‰ã„ã‚‰",
        "1345-396": "ä¸ä¿¡ ç–‘æƒ‘",
        "1445-408": "ææ€–",
        "1545-487": "ç½ªã®æ„è­˜",
        "1645-496": "å¦„æƒ³ãƒ»å¼·è¿«è¦³å¿µ",
        "1745-593": "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼",
        "1845-604": "è¿·ã„",
        "1945-605": "æ‡¸å¿µãƒ»ç¥çµŒè³ªãª",
        "2045-631": "å¿è€å¿ƒã®æ¬ å¦‚",
        "2145-648": "å¼·ã„ã„ã‚‰ã ã¡ãƒ»ã›ã£ã‹ã¡",
        "2345-720": "è‰¯å¿ƒã®å‘µè²¬",
        "2445-823": "ç–²åŠ´ãƒ»ã ã‚‹ã•",
        "2545-859": "æŠ‘é¬±",
        "2645-921": "æ¨ã¿",
        "2745-929": "æ·±ã„æ‚²ã—ã¿ãƒ»æ‚²å˜†",
        "2845-953": "éå¸¸ãªææ€–",
        "2955-005": "æ­»ã«å¯¾ã™ã‚‹ææ€–",
        "3055-011": "çµ¶æœ›ãƒ»è‡ªæš´è‡ªæ£„",
        "3155-015": "çŸ­æ°—",
        "3255-030": "å¯‚ã—ã•",
        "3355-038": "æ‚²ã—ã¿",
        "3455-055": "æ°—è‹¦åŠ´",
        "3555-058": "ä¸å¹¸",
        "3655-093": "è‡ªåˆ¶å¿ƒã‚’å¤±ã†æã‚Œ",
        "3755-102": "é ‘å›ºãƒ»ãƒ—ãƒ©ã‚¤ãƒ‰",
        "3855-144": "ãƒ‘ãƒ‹ãƒƒã‚¯",
        "3955-216": "ãƒ¡ãƒ©ãƒ³ã‚³ãƒªãƒ¼ãƒ»æ†‚é¬±",
        "4055-222": "ã‚¹ãƒˆãƒ¬ã‚¹",
        "4155-227": "æ„å›³ãƒ»ç›®è«–è¦‹",
        "4255-275": "æŠ‘åœ§",
        "4355-431": "ãƒ’ã‚¹ãƒ†ãƒªãƒ¼",
        "4455-702": "ã¯ã«ã‹ã¿ãƒ»å†…æ°—",
        "4555-916": "è‡ªå·±æ†æ†«",
        "4665-001": "ç„¡æ°—åŠ›",
        "4765-007": "ç’°å¢ƒã‚¹ãƒˆãƒ¬ã‚¹",
        "4875-315": "å¹»è¦šãƒ»å¦„æƒ³",
    },
    "æ¯’ç´ æ³¢å‹•": {
        "145-410": "é‰„æ²ˆç€",
        "245-459": "ç‚­ç´ æ²ˆç€",
        "345-679": "å‹•ç‰©æ¯’ç´ ",
        "445-684": "ç–²åŠ´æ¯’ç´ ",
        "545-695": "ã‚«ãƒ‰ãƒŸã‚¦ãƒ æ²ˆç€",
        "645-858": "ã‚«ãƒ«ã‚·ã‚¦ãƒ æ²ˆç€",
        "745-984": "ãƒŠãƒˆãƒªã‚¦ãƒ æ²ˆç€",
        "855-109": "åŸå­ç°",
        "955-160": "é‰„æ¬ ä¹",
        "1055-168": "ãƒãƒªã‚ªæ¯’ç´ ",
        "1155-170": "æ”¾å°„ç·šæ¯’ç´ ",
        "1255-487": "è‡­æ¯’ç´ ",
        "1355-860": "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ æ¯’",
        "1455-973": "ä¸€èˆ¬æ¯’",
        "1565-474": "ç¡«é»„æ¯’",
        "1665-029": "é€£é–çƒèŒç™ºèµ¤æ¯’ç´ ",
        "1765-029": "ãƒ–ãƒ‰ã‚¦çƒèŒæ¯’ç´ ",
        "1865-031": "è¶…çŸ­æ³¢æ”¾å°„ç·š",
        "1965-241": "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«æ¯’",
        "2065-242": "ãƒ¢ãƒ«ãƒ’ãƒæ¯’",
        "2165-243": "äºœé‰›æ¯’",
        "2265-305": "ã‚­ãƒ‹ãƒ¼ãƒæ¯’",
        "2365-432": "ãŸã°ã“ä¸­æ¯’",
        "2465-573": "ã‚³ã‚«ã‚¤ãƒ³æ¯’",
        "2565-639": "ãƒ©ã‚¸ã‚¦ãƒ ç†±å‚·",
        "2665-674": "çœŸé®æ¯’",
        "2765-707": "é‰›æ¯’",
        "2865-708": "ç´°èŒæ€§æ¯’",
        "2965-825": "é‰„æ¯’",
        "3065-874": "ãƒã‚°ãƒã‚·ã‚¦ãƒ æ¯’",
        "3175-182": "è›å…‰æ€§æ¯’",
        "3275-187": "ã‚«ãƒ«ã‚·ã‚¦ãƒ æ²ˆç€",
        "3375-384": "ãƒ¬ãƒ³ãƒˆã‚²ãƒ³ç„¼ã‘",
        "3475-585": "éŠ€æ¯’",
        "3575-584": "ãƒ‹ã‚³ãƒãƒ³æ¯’",
        "3685-051": "ã‚³ãƒãƒ«ãƒˆç†±å‚·",
        "3785-058": "ãƒ’ç´ ",
        "3885-069": "æ°´éŠ€æ¯’",
        "3985-074": "ãƒŠãƒˆãƒªã‚¦ãƒ æ¯’",
        "4085-118": "ãƒ¨ã‚¦ç´ æ¯’",
        "4185-149": "ã‚¢ãƒ˜ãƒ³æ¯’",
        "4285-178": "éº»è–¬ä¸­æ¯’",
        "4316-022": "ãƒªãƒ³ä¸­æ¯’",
        "4486-358": "ç´«å¤–ç·š",
    },
    "ã‚¦ã‚£ãƒ«ã‚¹æ³¢å‹•": {
        "135-492": "æŸ“è‰²ä½“",
        "245-193": "ãƒãƒŸãƒ³ (DNA)",
        "345-428": "ã‚¨ãƒ—ã‚¹ã‚¿ã‚¤ãƒ³ãƒãƒ¼ã‚¦ã‚£ãƒ«ã‚¹",
        "445-479": "ã‚¢ãƒ‡ãƒã‚¦ã‚£ãƒ«ã‚¹",
        "545-497": "ã‚¢ãƒ‡ãƒã‚¦ã‚£ãƒ«ã‚¹",
        "645-647": "Aå‹è‚ç‚ã‚¦ã‚£ãƒ«ã‚¹",
        "745-863": "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ã‚¦ã‚£ãƒ«ã‚¹ãƒ»ãƒ­ã‚·ã‚¢",
        "855-082": "ã‚³ãƒ­ãƒŠã‚¦ã‚£ãƒ«ã‚¹",
        "955-090": "ã‚µã‚¤ãƒˆãƒ¡ã‚¬ãƒ­ã‚¦ã‚£ãƒ«ã‚¹",
        "1055-122": "ã‚¨ã‚³ãƒ¼ã‚¦ã‚£ãƒ«ã‚¹",
        "1155-126": "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶",
        "1255-158": "ãƒ˜ãƒ«ãƒšã‚¹ã‚¦ã‚£ãƒ«ã‚¹",
        "1355-171": "ãƒ¬ã‚ªã‚¦ã‚£ãƒ«ã‚¹",
        "1455-329": "è‚ç‚",
        "1555-439": "ãƒ‘ãƒ©ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ã‚¦ã‚£ãƒ«ã‚¹",
        "1655-508": "ã‚³ã‚¯ã‚µãƒƒã‚­ãƒ¼ã‚¦ã‚£ãƒ«ã‚¹",
        "1755-510": "ã‚¨ã‚³ãƒ¼ã‚¦ã‚£ãƒ«ã‚¹",
        "1855-585": "ãƒ¯ã‚¯ãƒãƒ‹ã‚¢ã‚¦ã‚£ãƒ«ã‚¹",
        "1955-731": "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶ãƒ»ãƒ­ã‚·ã‚¢",
        "2065-010": "Bå‹è‚ç‚ã‚¦ã‚£ãƒ«ã‚¹",
        "2165-022": "ç°ç™½é«„ç‚ãƒ»ãƒãƒªã‚ª",
        "2265-121": "ã‚¦ã‚£ãƒ«ã‚¹",
        "2365-147": "ã‚¿ãƒã‚³ãƒ¢ã‚¶ã‚¤ã‚¯ã‚¦ã‚£ãƒ«ã‚¹",
        "2475-054": "ã‚¿ãƒ³ãƒ‘ã‚¯è³ª",
        "2585-120": "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶",
    }
}

# æ³¢å‹•ã«å¯¾ã™ã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨å¹¸é‹ã‚¢ã‚¤ãƒ†ãƒ 
hadou_advice = {
    # æ„Ÿæƒ…æ³¢å‹•ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    "æ€’ã‚Š": {
        "advice": "æ·±å‘¼å¸ã‚’ã—ã¦ã€å¿ƒã‚’è½ã¡ç€ã‘ã¾ã—ã‚‡ã†ã€‚ä»Šæ—¥ã¯å†·é™ãªåˆ¤æ–­ãŒå¤§åˆ‡ã§ã™ã€‚",
        "lucky_item": "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ã®é¦™ã‚Š",
        "color": "é’",
        "number": 7
    },
    "ç„¡é–¢å¿ƒãƒ»æ„Ÿæƒ…éº»ç—º": {
        "advice": "æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å°ã•ãªåˆºæ¿€ãŒå¿ƒã‚’å‹•ã‹ã—ã¾ã™ã€‚",
        "lucky_item": "ã‚«ãƒ©ãƒ•ãƒ«ãªèŠ±",
        "color": "ã‚ªãƒ¬ãƒ³ã‚¸",
        "number": 3
    },
    "å¹¸ç¦æ„Ÿã®æ¬ å¦‚": {
        "advice": "å°ã•ãªå¹¸ã›ã‚’è¦‹ã¤ã‘ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ„Ÿè¬ã®æ°—æŒã¡ãŒå¹¸é‹ã‚’å‘¼ã³ã¾ã™ã€‚",
        "lucky_item": "ãŠæ°—ã«å…¥ã‚Šã®éŸ³æ¥½",
        "color": "é»„è‰²",
        "number": 9
    },
    "å¿ƒé…ãƒ»ä¸å®‰": {
        "advice": "ä»Šã«é›†ä¸­ã—ã¾ã—ã‚‡ã†ã€‚å¿ƒé…äº‹ã®9å‰²ã¯èµ·ã“ã‚Šã¾ã›ã‚“ã€‚",
        "lucky_item": "ã‚¢ãƒ¡ã‚¸ã‚¹ãƒˆ",
        "color": "ç´«",
        "number": 5
    },
    "ã‚¹ãƒˆãƒ¬ã‚¹": {
        "advice": "ä»Šæ—¥ã¯è‡ªåˆ†ã¸ã®ã”è¤’ç¾ã‚’ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ã‚’å¤§åˆ‡ã«ã€‚",
        "lucky_item": "ãƒãƒ¼ãƒ–ãƒ†ã‚£ãƒ¼",
        "color": "ç·‘",
        "number": 2
    },
    # æ¯’ç´ æ³¢å‹•ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    "ç–²åŠ´æ¯’ç´ ": {
        "advice": "ä¼‘æ¯ãŒå¿…è¦ã§ã™ã€‚ä»Šæ—¥ã¯æ—©ã‚ã«ä¼‘ã‚“ã§ä½“ã‚’åŠ´ã‚ã‚Šã¾ã—ã‚‡ã†ã€‚",
        "lucky_item": "æ¸©ã‹ã„ãŠé¢¨å‘‚",
        "color": "ç™½",
        "number": 8
    },
    "ç’°å¢ƒæ¯’ç´ ": {
        "advice": "è‡ªç„¶ã®ä¸­ã§éã”ã™æ™‚é–“ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚æ–°é®®ãªç©ºæ°—ãŒå¹¸é‹ã‚’é‹ã³ã¾ã™ã€‚",
        "lucky_item": "è¦³è‘‰æ¤ç‰©",
        "color": "æ·±ç·‘",
        "number": 4
    },
    # ã‚¦ã‚£ãƒ«ã‚¹æ³¢å‹•ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    "ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚¶": {
        "advice": "å…ç–«åŠ›ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚ãƒ“ã‚¿ãƒŸãƒ³Cã¨ãŸã£ã·ã‚Šã®ç¡çœ ãŒå‘³æ–¹ã§ã™ã€‚",
        "lucky_item": "ãƒ¬ãƒ¢ãƒ³",
        "color": "é»„ç·‘",
        "number": 6
    }
}

class HadouFortuneApp:
    def __init__(self):
        self.history_file = "fortune_history.json"
        self.load_history()
        
    def load_history(self):
        """å ã„å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€"""
        if os.path.exists(self.history_file):
            with open(self.history_file, 'r', encoding='utf-8') as f:
                self.history = json.load(f)
        else:
            self.history = []
    
    def save_history(self, result):
        """å ã„çµæœã‚’å±¥æ­´ã«ä¿å­˜"""
        self.history.append(result)
        # æœ€æ–°ã®10ä»¶ã®ã¿ä¿å­˜
        if len(self.history) > 10:
            self.history = self.history[-10:]
        with open(self.history_file, 'w', encoding='utf-8') as f:
            json.dump(self.history, f, ensure_ascii=False, indent=2)
    
    def get_zodiac_sign(self, month, day):
        """èª•ç”Ÿæ—¥ã‹ã‚‰æ˜Ÿåº§ã‚’åˆ¤å®š"""
        zodiac_dates = [
            (1, 20, "å±±ç¾Šåº§"), (2, 19, "æ°´ç“¶åº§"), (3, 21, "é­šåº§"),
            (4, 20, "ç‰¡ç¾Šåº§"), (5, 21, "ç‰¡ç‰›åº§"), (6, 21, "åŒå­åº§"),
            (7, 23, "èŸ¹åº§"), (8, 23, "ç…å­åº§"), (9, 23, "ä¹™å¥³åº§"),
            (10, 23, "å¤©ç§¤åº§"), (11, 22, "è åº§"), (12, 22, "å°„æ‰‹åº§"),
            (12, 31, "å±±ç¾Šåº§")
        ]
        
        for end_month, end_day, sign in zodiac_dates:
            if month < end_month or (month == end_month and day <= end_day):
                return sign
        return "å±±ç¾Šåº§"
    
    def get_detailed_advice(self, hadou_name):
        """æ³¢å‹•ã«åŸºã¥ã„ãŸè©³ç´°ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å–å¾—"""
        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
        default_advice = {
            "advice": "ä»Šæ—¥ã¯æ–°ã—ã„ç™ºè¦‹ãŒã‚ã‚Šãã†ã§ã™ã€‚å‰å‘ãã«éã”ã—ã¾ã—ã‚‡ã†ã€‚",
            "lucky_item": "ã‚¯ãƒªã‚¹ã‚¿ãƒ«",
            "color": "è™¹è‰²",
            "number": random.randint(1, 9)
        }
        
        # å®Œå…¨ä¸€è‡´ã‚’æ¢ã™
        if hadou_name in hadou_advice:
            return hadou_advice[hadou_name]
        
        # éƒ¨åˆ†ä¸€è‡´ã‚’æ¢ã™
        for key in hadou_advice:
            if key in hadou_name or hadou_name in key:
                return hadou_advice[key]
        
        # ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆ
        if "ææ€–" in hadou_name:
            return {
                "advice": "å‹‡æ°—ã‚’æŒã£ã¦ä¸€æ­©è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚æã‚Œã¯å¹»æƒ³ã§ã™ã€‚",
                "lucky_item": "ãŠå®ˆã‚Š",
                "color": "èµ¤",
                "number": 1
            }
        elif "æ¯’" in hadou_name or "æ¯’ç´ " in hadou_name:
            return {
                "advice": "ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚æ°´åˆ†ã‚’ãŸãã•ã‚“æ‘‚ã£ã¦ã€‚",
                "lucky_item": "ãƒ¬ãƒ¢ãƒ³æ°´",
                "color": "é€æ˜",
                "number": 0
            }
        elif "ã‚¦ã‚£ãƒ«ã‚¹" in hadou_name:
            return {
                "advice": "å¥åº·ç¬¬ä¸€ã€‚æ‰‹æ´—ã„ã†ãŒã„ã‚’å¿˜ã‚Œãšã«ã€‚",
                "lucky_item": "ãƒã‚¹ã‚¯",
                "color": "ç™½",
                "number": 8
            }
        
        return default_advice
    
    def calculate_compatibility(self, hadou_code):
        """æ³¢å‹•ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç›¸æ€§ã®è‰¯ã„äººã‚’è¨ˆç®—"""
        code_numbers = [int(x) for x in re.findall(r'\d+', hadou_code)]
        total = sum(code_numbers) % 12
        
        compatibility_types = [
            "ãƒªãƒ¼ãƒ€ãƒ¼ã‚¿ã‚¤ãƒ—", "ã‚µãƒãƒ¼ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—", "ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—",
            "ã‚¢ãƒŠãƒªã‚¹ãƒˆã‚¿ã‚¤ãƒ—", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—", "ãƒ’ãƒ¼ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—",
            "ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã‚¿ã‚¤ãƒ—", "ã‚ªãƒ¼ã‚¬ãƒŠã‚¤ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—", "ãƒ“ã‚¸ãƒ§ãƒŠãƒªãƒ¼ã‚¿ã‚¤ãƒ—",
            "ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—", "ã‚¤ãƒãƒ™ãƒ¼ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ—", "ãƒãƒ¼ãƒ¢ãƒŠã‚¤ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—"
        ]
        
        return compatibility_types[total]
    
    def generate_biorhythm(self):
        """ä»Šæ—¥ã®ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã‚’ç”Ÿæˆ"""
        today = datetime.now()
        day_of_year = today.timetuple().tm_yday
        
        # ç°¡æ˜“çš„ãªãƒã‚¤ã‚ªãƒªã‚ºãƒ è¨ˆç®—
        physical = int(50 + 50 * random.random())
        emotional = int(50 + 50 * random.random())
        intellectual = int(50 + 50 * random.random())
        
        return {
            "physical": physical,
            "emotional": emotional,
            "intellectual": intellectual
        }
    
    def fortune_telling(self):
        """å ã„ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½"""
        print("\n" + "="*50)
        print("âœ¨ æ³¢å‹•å ã„ã‚¢ãƒ—ãƒª Premium âœ¨".center(50))
        print("="*50 + "\n")
        
        # åå‰ã®å…¥åŠ›
        name = input("ã‚ãªãŸã®ãŠåå‰ã‚’æ•™ãˆã¦ãã ã•ã„: ")
        
        # èª•ç”Ÿæ—¥ã®å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        use_birthday = input("èª•ç”Ÿæ—¥ã‚’ä½¿ã£ãŸè©³ç´°å ã„ã‚’ã—ã¾ã™ã‹ï¼Ÿ (y/n): ").lower()
        zodiac = None
        if use_birthday == 'y':
            try:
                month = int(input("ç”Ÿã¾ã‚ŒãŸæœˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (1-12): "))
                day = int(input("ç”Ÿã¾ã‚ŒãŸæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„: "))
                zodiac = self.get_zodiac_sign(month, day)
            except ValueError:
                print("æ­£ã—ã„æ•°å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
        
        print("\nå ã„ãŸã„ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§ãã ã•ã„ï¼š")
        print("-" * 30)
        
        # ã‚«ãƒ†ã‚´ãƒªã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
        categories = list(hadou_data.keys())
        categories.append("å…¨ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ")
        
        for i, category in enumerate(categories):
            print(f"{i + 1}: {category}")
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã•ã›ã‚‹
        while True:
            try:
                choice = int(input("\nç•ªå·ã‚’é¸æŠã—ã¦ãã ã•ã„: "))
                if 1 <= choice <= len(categories):
                    if choice == len(categories):
                        # å…¨ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ 
                        all_codes = {}
                        for cat_data in hadou_data.values():
                            all_codes.update(cat_data)
                        selected_category_name = "å…¨ã‚«ãƒ†ã‚´ãƒª"
                        selected_category_data = all_codes
                    else:
                        selected_category_name = categories[choice - 1]
                        selected_category_data = hadou_data[selected_category_name]
                    break
                else:
                    print("æ­£ã—ã„ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
            except ValueError:
                print("ç•ªå·ã‚’æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
        
        # é¸æŠã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸€ã¤é¸ã¶
        random_code = random.choice(list(selected_category_data.keys()))
        random_hadou = selected_category_data[random_code]
        
        # è©³ç´°ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å–å¾—
        advice_data = self.get_detailed_advice(random_hadou)
        
        # ç›¸æ€§ã®è‰¯ã„ã‚¿ã‚¤ãƒ—ã‚’è¨ˆç®—
        compatible_type = self.calculate_compatibility(random_code)
        
        # ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã‚’ç”Ÿæˆ
        biorhythm = self.generate_biorhythm()
        
        # çµæœã®è¡¨ç¤º
        print("\n" + "="*50)
        print("ğŸ”® å ã„çµæœ ğŸ”®".center(50))
        print("="*50)
        print(f"\n{name}ã•ã‚“ã®ä»Šæ—¥ã®æ³¢å‹•")
        print("-" * 30)
        print(f"æ³¢å‹•: ã€{random_hadou}ã€‘")
        print(f"æ³¢å‹•ã‚³ãƒ¼ãƒ‰: {random_code}")
        print(f"ã‚«ãƒ†ã‚´ãƒª: {selected_category_name}")
        
        if zodiac:
            print(f"æ˜Ÿåº§: {zodiac}")
        
        print("\nğŸ“ ä»Šæ—¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹")
        print("-" * 30)
        print(f"{advice_data['advice']}")
        
        print("\nğŸ€ ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ")
        print("-" * 30)
        print(f"ã‚¢ã‚¤ãƒ†ãƒ : {advice_data['lucky_item']}")
        print(f"ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼: {advice_data['color']}")
        print(f"ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼: {advice_data['number']}")
        
        print("\nğŸ’‘ ç›¸æ€§ã®è‰¯ã„ã‚¿ã‚¤ãƒ—")
        print("-" * 30)
        print(f"ä»Šæ—¥ã®ã‚ãªãŸã¨ç›¸æ€§ãŒè‰¯ã„ã®ã¯ã€{compatible_type}ã€‘ã®äººã§ã™")
        
        print("\nğŸ“Š ä»Šæ—¥ã®ãƒã‚¤ã‚ªãƒªã‚ºãƒ ")
        print("-" * 30)
        print(f"èº«ä½“: {'â–“' * (biorhythm['physical'] // 10)}{'â–‘' * (10 - biorhythm['physical'] // 10)} {biorhythm['physical']}%")
        print(f"æ„Ÿæƒ…: {'â–“' * (biorhythm['emotional'] // 10)}{'â–‘' * (10 - biorhythm['emotional'] // 10)} {biorhythm['emotional']}%")
        print(f"çŸ¥æ€§: {'â–“' * (biorhythm['intellectual'] // 10)}{'â–‘' * (10 - biorhythm['intellectual'] // 10)} {biorhythm['intellectual']}%")
        
        # ç·åˆé‹å‹¢
        total_luck = (biorhythm['physical'] + biorhythm['emotional'] + biorhythm['intellectual']) // 3
        stars = "â˜…" * (total_luck // 20) + "â˜†" * (5 - total_luck // 20)
        print(f"\nâ­ ç·åˆé‹å‹¢: {stars}")
        
        print("\n" + "="*50)
        print("ç´ æ•µãªä¸€æ—¥ã‚’ãŠéã”ã—ãã ã•ã„ï¼âœ¨")
        print("="*50)
        
        # å±¥æ­´ã«ä¿å­˜
        result = {
            "date": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            "name": name,
            "hadou": random_hadou,
            "code": random_code,
            "category": selected_category_name,
            "total_luck": total_luck
        }
        self.save_history(result)
        
        # è¿½åŠ æ©Ÿèƒ½ã®ææ¡ˆ
        self.additional_features()
    
    def additional_features(self):
        """è¿½åŠ æ©Ÿèƒ½ãƒ¡ãƒ‹ãƒ¥ãƒ¼"""
        print("\nè¿½åŠ æ©Ÿèƒ½:")
        print("1: å ã„å±¥æ­´ã‚’è¦‹ã‚‹")
        print("2: ã‚‚ã†ä¸€åº¦å ã†")
        print("3: çµ‚äº†")
        
        choice = input("\né¸æŠã—ã¦ãã ã•ã„ (1-3): ")
        
        if choice == "1":
            self.show_history()
        elif choice == "2":
            self.fortune_telling()
        elif choice == "3":
            print("\nã¾ãŸã®ã”åˆ©ç”¨ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼ğŸŒŸ")
        else:
            print("\nçµ‚äº†ã—ã¾ã™ã€‚")
    
    def show_history(self):
        """å ã„å±¥æ­´ã‚’è¡¨ç¤º"""
        if not self.history:
            print("\nã¾ã å ã„å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")
        else:
            print("\nğŸ“œ å ã„å±¥æ­´")
            print("="*50)
            for i, record in enumerate(self.history[-5:], 1):  # æœ€æ–°5ä»¶ã‚’è¡¨ç¤º
                print(f"\n{i}. {record['date']}")
                print(f"   åå‰: {record['name']}")
                print(f"   æ³¢å‹•: {record['hadou']} ({record['code']})")
                print(f"   ç·åˆé‹å‹¢: {'â˜…' * (record['total_luck'] // 20)}{'â˜†' * (5 - record['total_luck'] // 20)}")
        
        self.additional_features()


def main():
    app = HadouFortuneApp()
    app.fortune_telling()


if __name__ == "__main__":
    main()
